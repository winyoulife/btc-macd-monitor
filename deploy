#!/bin/bash

# Heroku éƒ¨ç½²è…³æœ¬
echo "ğŸš€ é–‹å§‹éƒ¨ç½²åˆ° Heroku..."

# æª¢æŸ¥æ˜¯å¦å·²ç™»éŒ„ Heroku
if ! heroku whoami &> /dev/null; then
    echo "âŒ è«‹å…ˆç™»éŒ„ Heroku: heroku login"
    exit 1
fi

# æ‡‰ç”¨åç¨±
APP_NAME=${1:-btc-macd-monitor}

echo "ğŸ“ æ‡‰ç”¨åç¨±: $APP_NAME"

# å‰µå»º Heroku æ‡‰ç”¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
if ! heroku apps:info $APP_NAME &> /dev/null; then
    echo "ğŸ†• å‰µå»ºæ–°çš„ Heroku æ‡‰ç”¨..."
    heroku create $APP_NAME --region us
fi

# è¨­ç½® Heroku stack ç‚º container
echo "ğŸ³ è¨­ç½®å®¹å™¨éƒ¨ç½²..."
heroku stack:set container -a $APP_NAME

# è¨­ç½®ç’°å¢ƒè®Šé‡
echo "âš™ï¸  è¨­ç½®ç’°å¢ƒè®Šé‡..."
echo "è«‹åœ¨ Heroku Dashboard æˆ–ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¨­ç½®ç’°å¢ƒè®Šé‡ï¼š"
echo ""
echo "heroku config:set TELEGRAM_BOT_TOKEN=your_bot_token -a $APP_NAME"
echo "heroku config:set TELEGRAM_CHAT_ID=your_chat_id -a $APP_NAME"
echo ""

# éƒ¨ç½²
echo "ğŸš¢ é–‹å§‹éƒ¨ç½²..."
git add -A
git commit -m "Deploy cloud monitor to Heroku" || true
git push heroku main

# è¨­ç½® worker dyno
echo "âš¡ å•Ÿå‹•æ‡‰ç”¨..."
heroku ps:scale web=1 -a $APP_NAME

# é¡¯ç¤ºæ‡‰ç”¨ä¿¡æ¯
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo ""
echo "ğŸ”— æ‡‰ç”¨URL: https://$APP_NAME.herokuapp.com"
echo "ğŸ“Š å¥åº·æª¢æŸ¥: https://$APP_NAME.herokuapp.com/health"
echo "ğŸ“ˆ ç‹€æ…‹æª¢æŸ¥: https://$APP_NAME.herokuapp.com/status"
echo ""
echo "ğŸ“ æŸ¥çœ‹æ—¥èªŒ: heroku logs --tail -a $APP_NAME"
echo "ğŸ”§ ç®¡ç†æ‡‰ç”¨: heroku open -a $APP_NAME" 