<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>🚀 BTC專業技術分析直播站 🚀</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(45deg, #0a0a23, #1a1a2e, #16213e);
            color: #00ff88;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
        }
        
        .header {
            background: rgba(0,0,0,0.9);
            padding: 15px 0;
            text-align: center;
            border-bottom: 2px solid #00ff88;
            position: relative;
        }
        
        .title {
            font-size: 2.5em;
            text-shadow: 0 0 20px #00ff88;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px #00ff88; }
            to { text-shadow: 0 0 30px #00ff88, 0 0 40px #00ff88; }
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .price-section {
            background: rgba(0,0,0,0.8);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .current-price {
            font-size: 4em;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 15px #00ff88;
        }
        
        .price-change {
            font-size: 1.5em;
            margin: 10px 0;
        }
        
        .indicators-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .indicator-box {
            background: rgba(0,20,40,0.8);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .indicator-title {
            font-size: 1.2em;
            color: #00ff88;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .indicator-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .indicator-signal {
            font-size: 1em;
            margin-top: 5px;
            padding: 5px;
            border-radius: 5px;
        }
        
        .bullish { color: #00ff00; background: rgba(0,255,0,0.1); }
        .bearish { color: #ff4444; background: rgba(255,68,68,0.1); }
        .neutral { color: #ffaa00; background: rgba(255,170,0,0.1); }
        
        .chart-container {
            background: rgba(0,0,0,0.8);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            height: 600px;
        }
        
        .signals-section {
            grid-column: 1 / -1;
            background: rgba(0,0,0,0.8);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .signals-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .signal-box {
            background: rgba(0,30,60,0.8);
            border: 2px solid;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .bottom-signal {
            border-color: #00ff00;
            background: rgba(0,255,0,0.05);
        }
        
        .top-signal {
            border-color: #ff4444;
            background: rgba(255,68,68,0.05);
        }
        
        .signal-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .signal-conditions {
            text-align: left;
            margin: 10px 0;
        }
        
        .condition {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .condition.met {
            background: rgba(0,255,0,0.2);
            color: #00ff00;
        }
        
        .condition.not-met {
            background: rgba(255,68,68,0.2);
            color: #ff6666;
        }
        
        .signal-strength {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .market-data {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .data-item {
            background: rgba(0,20,40,0.6);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        
        .data-label {
            font-size: 0.9em;
            color: #aaa;
        }
        
        .data-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .update-time {
            text-align: center;
            margin-top: 20px;
            color: #888;
            font-size: 0.9em;
        }
        
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            .signals-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">🚀 BTC專業技術分析直播站 🚀</div>
        <div style="margin-top: 10px; font-size: 1.2em;">
            💎 多指標交叉確認 | 🎯 精準抓轉折點 | 📊 實時技術分析
        </div>
    </div>

    <div class="main-container">
        <!-- 價格顯示區 -->
        <div class="price-section">
            <h2>💰 BTC/USDT 實時價格</h2>
            <div class="current-price" id="currentPrice">載入中...</div>
            <div class="price-change" id="priceChange">--</div>
            
            <div class="market-data">
                <div class="data-item">
                    <div class="data-label">24H 高點</div>
                    <div class="data-value" id="high24h">--</div>
                </div>
                <div class="data-item">
                    <div class="data-label">24H 低點</div>
                    <div class="data-value" id="low24h">--</div>
                </div>
                <div class="data-item">
                    <div class="data-label">24H 成交量</div>
                    <div class="data-value" id="volume24h">--</div>
                </div>
                <div class="data-item">
                    <div class="data-label">市值排名</div>
                    <div class="data-value">#1</div>
                </div>
            </div>
            
            <!-- 技術指標顯示 -->
            <div class="indicators-grid">
                <div class="indicator-box">
                    <div class="indicator-title">MACD (12,26,9)</div>
                    <div class="indicator-value" id="macdValue">--</div>
                    <div class="indicator-signal" id="macdSignal">計算中...</div>
                </div>
                
                <div class="indicator-box">
                    <div class="indicator-title">RSI (14)</div>
                    <div class="indicator-value" id="rsiValue">--</div>
                    <div class="indicator-signal" id="rsiSignal">計算中...</div>
                </div>
                
                <div class="indicator-box">
                    <div class="indicator-title">布林通道</div>
                    <div class="indicator-value" id="bbValue">--</div>
                    <div class="indicator-signal" id="bbSignal">計算中...</div>
                </div>
                
                <div class="indicator-box">
                    <div class="indicator-title">均線趨勢</div>
                    <div class="indicator-value" id="maValue">--</div>
                    <div class="indicator-signal" id="maSignal">計算中...</div>
                </div>
            </div>
        </div>

        <!-- 圖表區 -->
        <div class="chart-container">
            <canvas id="priceChart"></canvas>
        </div>
    </div>

    <!-- 交易訊號分析區 -->
    <div class="signals-section">
        <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.8em;">
            🎯 轉折點訊號分析 - 多指標交叉確認
        </h2>
        
        <div class="signals-grid">
            <!-- 底部反彈訊號 -->
            <div class="signal-box bottom-signal">
                <div class="signal-title" style="color: #00ff00;">
                    📉 底部反彈訊號檢測
                </div>
                
                <div class="signal-conditions">
                    <div class="condition" id="macdBullish">
                        🔸 MACD金叉 + 柱狀圖轉綠
                    </div>
                    <div class="condition" id="rsiBullish">
                        🔸 RSI < 30 開始向上彎
                    </div>
                    <div class="condition" id="maBullish">
                        🔸 K線站回MA5/MA10
                    </div>
                    <div class="condition" id="bbBullish">
                        🔸 跌破下軌後收回軌內
                    </div>
                    <div class="condition" id="volumeBullish">
                        🔸 反彈時放量確認
                    </div>
                </div>
                
                <div class="signal-strength" id="bullishStrength">
                    訊號強度: 計算中...
                </div>
            </div>

            <!-- 高點回測訊號 -->
            <div class="signal-box top-signal">
                <div class="signal-title" style="color: #ff4444;">
                    📈 高點回測訊號檢測
                </div>
                
                <div class="signal-conditions">
                    <div class="condition" id="macdBearish">
                        🔸 MACD死叉 + 柱狀圖轉紅
                    </div>
                    <div class="condition" id="rsiBearish">
                        🔸 RSI > 70 出現下彎
                    </div>
                    <div class="condition" id="maBearish">
                        🔸 K線跌破MA5/MA10
                    </div>
                    <div class="condition" id="bbBearish">
                        🔸 衝破上軌但拉回
                    </div>
                    <div class="condition" id="volumeBearish">
                        🔸 高點爆量或上漲無量
                    </div>
                </div>
                
                <div class="signal-strength" id="bearishStrength">
                    訊號強度: 計算中...
                </div>
            </div>
        </div>
    </div>

    <div class="update-time" id="updateTime">
        最後更新: --
    </div>

    <script>
        // 全局變數
        let priceData = [];
        let priceChart;
        let currentPrice = 0;
        let previousPrice = 0;

        // 初始化圖表
        function initChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'BTC Price',
                        data: [],
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0,255,136,0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'MA5',
                        data: [],
                        borderColor: '#ffaa00',
                        borderWidth: 1,
                        fill: false
                    }, {
                        label: 'MA10',
                        data: [],
                        borderColor: '#ff6600',
                        borderWidth: 1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#00ff88'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#00ff88' },
                            grid: { color: 'rgba(0,255,136,0.2)' }
                        },
                        y: {
                            ticks: { color: '#00ff88' },
                            grid: { color: 'rgba(0,255,136,0.2)' }
                        }
                    }
                }
            });
        }

        // 計算技術指標
        function calculateIndicators(prices) {
            if (prices.length < 26) return null;
            
            // 計算MACD
            const macd = calculateMACD(prices);
            
            // 計算RSI
            const rsi = calculateRSI(prices, 14);
            
            // 計算布林通道
            const bb = calculateBollingerBands(prices, 20, 2);
            
            // 計算移動平均
            const ma5 = calculateMA(prices, 5);
            const ma10 = calculateMA(prices, 10);
            
            return { macd, rsi, bb, ma5, ma10 };
        }

        // MACD計算
        function calculateMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            
            if (!ema12 || !ema26) return null;
            
            const macdLine = ema12 - ema26;
            const signal = calculateEMA([macdLine], 9);
            const histogram = macdLine - (signal || 0);
            
            return { macdLine, signal, histogram };
        }

        // RSI計算
        function calculateRSI(prices, period) {
            if (prices.length < period + 1) return null;
            
            let gains = 0, losses = 0;
            
            for (let i = prices.length - period; i < prices.length; i++) {
                const change = prices[i] - prices[i-1];
                if (change > 0) gains += change;
                else losses -= change;
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            
            if (avgLoss === 0) return 100;
            
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        // 布林通道計算
        function calculateBollingerBands(prices, period, multiplier) {
            if (prices.length < period) return null;
            
            const recentPrices = prices.slice(-period);
            const sma = recentPrices.reduce((a, b) => a + b) / period;
            
            const variance = recentPrices.reduce((sum, price) => {
                return sum + Math.pow(price - sma, 2);
            }, 0) / period;
            
            const stdDev = Math.sqrt(variance);
            
            return {
                upper: sma + (stdDev * multiplier),
                middle: sma,
                lower: sma - (stdDev * multiplier)
            };
        }

        // EMA計算
        function calculateEMA(prices, period) {
            if (prices.length < period) return null;
            
            const multiplier = 2 / (period + 1);
            let ema = prices[0];
            
            for (let i = 1; i < prices.length; i++) {
                ema = (prices[i] * multiplier) + (ema * (1 - multiplier));
            }
            
            return ema;
        }

        // 移動平均計算
        function calculateMA(prices, period) {
            if (prices.length < period) return null;
            
            const recentPrices = prices.slice(-period);
            return recentPrices.reduce((a, b) => a + b) / period;
        }

        // 更新技術指標顯示
        function updateIndicators(indicators) {
            if (!indicators) return;
            
            // 更新MACD
            if (indicators.macd) {
                document.getElementById('macdValue').textContent = 
                    indicators.macd.macdLine.toFixed(2);
                
                const macdSignal = indicators.macd.histogram > 0 ? 
                    (indicators.macd.macdLine > indicators.macd.signal ? '🟢 金叉' : '🟡 多頭') :
                    '🔴 死叉';
                document.getElementById('macdSignal').textContent = macdSignal;
                document.getElementById('macdSignal').className = 
                    `indicator-signal ${indicators.macd.histogram > 0 ? 'bullish' : 'bearish'}`;
            }
            
            // 更新RSI
            if (indicators.rsi) {
                document.getElementById('rsiValue').textContent = 
                    indicators.rsi.toFixed(1);
                
                let rsiSignal, rsiClass;
                if (indicators.rsi < 30) {
                    rsiSignal = '🟢 超賣';
                    rsiClass = 'bullish';
                } else if (indicators.rsi > 70) {
                    rsiSignal = '🔴 超買';
                    rsiClass = 'bearish';
                } else {
                    rsiSignal = '🟡 中性';
                    rsiClass = 'neutral';
                }
                
                document.getElementById('rsiSignal').textContent = rsiSignal;
                document.getElementById('rsiSignal').className = `indicator-signal ${rsiClass}`;
            }
            
            // 更新布林通道
            if (indicators.bb) {
                const currentPrice = priceData[priceData.length - 1];
                let bbSignal, bbClass;
                
                if (currentPrice < indicators.bb.lower) {
                    bbSignal = '🟢 跌破下軌';
                    bbClass = 'bullish';
                } else if (currentPrice > indicators.bb.upper) {
                    bbSignal = '🔴 突破上軌';
                    bbClass = 'bearish';
                } else {
                    bbSignal = '🟡 軌道內';
                    bbClass = 'neutral';
                }
                
                document.getElementById('bbValue').textContent = 
                    `${indicators.bb.upper.toFixed(0)} / ${indicators.bb.lower.toFixed(0)}`;
                document.getElementById('bbSignal').textContent = bbSignal;
                document.getElementById('bbSignal').className = `indicator-signal ${bbClass}`;
            }
            
            // 更新均線
            if (indicators.ma5 && indicators.ma10) {
                const currentPrice = priceData[priceData.length - 1];
                let maSignal, maClass;
                
                if (currentPrice > indicators.ma5 && indicators.ma5 > indicators.ma10) {
                    maSignal = '🟢 多頭排列';
                    maClass = 'bullish';
                } else if (currentPrice < indicators.ma5 && indicators.ma5 < indicators.ma10) {
                    maSignal = '🔴 空頭排列';
                    maClass = 'bearish';
                } else {
                    maSignal = '🟡 盤整';
                    maClass = 'neutral';
                }
                
                document.getElementById('maValue').textContent = 
                    `MA5: ${indicators.ma5.toFixed(0)} | MA10: ${indicators.ma10.toFixed(0)}`;
                document.getElementById('maSignal').textContent = maSignal;
                document.getElementById('maSignal').className = `indicator-signal ${maClass}`;
            }
        }

        // 更新交易訊號
        function updateTradingSignals(indicators) {
            if (!indicators) return;
            
            let bullishCount = 0, bearishCount = 0;
            
            // 檢查底部反彈條件
            const macdBullish = indicators.macd && indicators.macd.histogram > 0;
            const rsiBullish = indicators.rsi && indicators.rsi < 30;
            const maBullish = indicators.ma5 && indicators.ma10 && 
                             priceData[priceData.length - 1] > indicators.ma5;
            const bbBullish = indicators.bb && 
                             priceData[priceData.length - 1] > indicators.bb.lower;
            const volumeBullish = true; // 簡化處理
            
            // 更新底部反彈條件顯示
            updateCondition('macdBullish', macdBullish);
            updateCondition('rsiBullish', rsiBullish);
            updateCondition('maBullish', maBullish);
            updateCondition('bbBullish', bbBullish);
            updateCondition('volumeBullish', volumeBullish);
            
            bullishCount = [macdBullish, rsiBullish, maBullish, bbBullish, volumeBullish]
                          .filter(Boolean).length;
            
            // 檢查高點回測條件
            const macdBearish = indicators.macd && indicators.macd.histogram < 0;
            const rsiBearish = indicators.rsi && indicators.rsi > 70;
            const maBearish = indicators.ma5 && indicators.ma10 && 
                             priceData[priceData.length - 1] < indicators.ma5;
            const bbBearish = indicators.bb && 
                             priceData[priceData.length - 1] > indicators.bb.upper;
            const volumeBearish = false; // 簡化處理
            
            // 更新高點回測條件顯示
            updateCondition('macdBearish', macdBearish);
            updateCondition('rsiBearish', rsiBearish);
            updateCondition('maBearish', maBearish);
            updateCondition('bbBearish', bbBearish);
            updateCondition('volumeBearish', volumeBearish);
            
            bearishCount = [macdBearish, rsiBearish, maBearish, bbBearish, volumeBearish]
                          .filter(Boolean).length;
            
            // 更新訊號強度
            updateSignalStrength('bullishStrength', bullishCount, '底部反彈');
            updateSignalStrength('bearishStrength', bearishCount, '高點回測');
        }

        function updateCondition(id, met) {
            const element = document.getElementById(id);
            element.className = `condition ${met ? 'met' : 'not-met'}`;
        }

        function updateSignalStrength(id, count, type) {
            const element = document.getElementById(id);
            const percentage = (count / 5) * 100;
            
            let strengthText, className;
            if (percentage >= 80) {
                strengthText = `🔥 ${type}機率極高 (${count}/5)`;
                className = 'bullish';
            } else if (percentage >= 60) {
                strengthText = `⚡ ${type}機率高 (${count}/5)`;
                className = 'neutral';
            } else if (percentage >= 40) {
                strengthText = `⚠️ ${type}機率中等 (${count}/5)`;
                className = 'neutral';
            } else {
                strengthText = `❌ ${type}機率低 (${count}/5)`;
                className = 'bearish';
            }
            
            element.textContent = strengthText;
            element.className = `signal-strength ${className}`;
        }

        // 獲取BTC價格
        async function fetchBTCPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true&include_high_low_24h=true');
                const data = await response.json();
                
                previousPrice = currentPrice;
                currentPrice = data.bitcoin.usd;
                
                // 更新價格顯示
                document.getElementById('currentPrice').textContent = 
                    `$${currentPrice.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // 更新價格變化
                const change = data.bitcoin.usd_24h_change;
                const changeElement = document.getElementById('priceChange');
                changeElement.textContent = 
                    `24H: ${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeElement.style.color = change >= 0 ? '#00ff00' : '#ff4444';
                
                // 更新市場數據
                document.getElementById('high24h').textContent = 
                    `$${data.bitcoin.usd_24h_high?.toLocaleString() || '--'}`;
                document.getElementById('low24h').textContent = 
                    `$${data.bitcoin.usd_24h_low?.toLocaleString() || '--'}`;
                document.getElementById('volume24h').textContent = 
                    `$${(data.bitcoin.usd_24h_vol / 1000000000).toFixed(1)}B`;
                
                // 添加到價格數據
                priceData.push(currentPrice);
                if (priceData.length > 100) {
                    priceData.shift();
                }
                
                // 計算技術指標
                const indicators = calculateIndicators(priceData);
                updateIndicators(indicators);
                updateTradingSignals(indicators);
                
                // 更新圖表
                updateChart();
                
                // 更新時間
                document.getElementById('updateTime').textContent = 
                    `最後更新: ${new Date().toLocaleString('zh-TW')}`;
                
            } catch (error) {
                console.error('獲取價格失敗:', error);
                document.getElementById('currentPrice').textContent = '獲取失敗';
            }
        }

        // 更新圖表
        function updateChart() {
            if (!priceChart || priceData.length === 0) return;
            
            const labels = priceData.map((_, index) => {
                const time = new Date(Date.now() - (priceData.length - 1 - index) * 30000);
                return time.toLocaleTimeString('zh-TW', {hour: '2-digit', minute: '2-digit'});
            });
            
            priceChart.data.labels = labels;
            priceChart.data.datasets[0].data = priceData;
            
            // 計算並添加移動平均線
            if (priceData.length >= 5) {
                const ma5Data = priceData.map((_, index) => {
                    if (index < 4) return null;
                    return calculateMA(priceData.slice(index - 4, index + 1), 5);
                });
                priceChart.data.datasets[1].data = ma5Data;
            }
            
            if (priceData.length >= 10) {
                const ma10Data = priceData.map((_, index) => {
                    if (index < 9) return null;
                    return calculateMA(priceData.slice(index - 9, index + 1), 10);
                });
                priceChart.data.datasets[2].data = ma10Data;
            }
            
            priceChart.update('none');
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            fetchBTCPrice();
            
            // 每30秒更新一次
            setInterval(fetchBTCPrice, 30000);
        });
    </script>
</body>
</html> 